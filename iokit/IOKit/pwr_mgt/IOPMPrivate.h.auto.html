<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>IOPMPrivate.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">IOPMPrivate.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2002 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_IOKIT_IOPMPRIVATE_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_IOKIT_IOPMPRIVATE_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;IOKit/pwr_mgt/IOPM.h&gt;</span>

<span class="enscript-comment">/* @constant kIOPMEventTypeIntermediateFlag
 * @abstract This bit indicates the event is an intermediate event
 *      which must occur within a major system power event.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMEventTypeIntermediateFlag</span>              0x10000000

<span class="enscript-comment">/* @enum SystemEventTypes
 * @abstract Potential system events logged in the system event record.
 */</span>
<span class="enscript-type">enum</span> {
    kIOPMEventTypeUndefined                     = 0,

    <span class="enscript-comment">/* Event types mark driver events
     */</span>
    kIOPMEventTypeSetPowerStateImmediate        = 1001,
    kIOPMEventTypeSetPowerStateDelayed          = 1002,
    kIOPMEventTypePSWillChangeTo                = 1003,
    kIOPMEventTypePSDidChangeTo                 = 1004,
    kIOPMEventTypeAppResponse                   = 1005,


    <span class="enscript-comment">/* Start and stop event types bracket major
     * system power management events.
     */</span>
    kIOPMEventTypeSleep                         = 2001,
    kIOPMEventTypeSleepDone                     = 2002,
    kIOPMEventTypeWake                          = 3001,
    kIOPMEventTypeWakeDone                      = 3002,
    kIOPMEventTypeDoze                          = 4001,
    kIOPMEventTypeDozeDone                      = 4002,
    kIOPMEventTypeUUIDSet                       = 6001,
    kIOPMEventTypeUUIDClear                     = 6002,

    <span class="enscript-comment">/* Intermediate events that may only occur within the bounds
     * of a major system event (between the event's initiation and its &quot;done event&quot;.)
     * e.g. chronologically kIOPMEventTypeSleep may be followed by one or more
     *      intermediate events, which then must be followed by kIOPMEventTypeSleepDone.
     *
     * The intermediate events below will always occur in a Sleep or Wake event, and may
     *      or may not occur for any of the other events.
     */</span>
    kIOPMEventTypeAppNotificationsFinished      = 501 | kIOPMEventTypeIntermediateFlag,
    kIOPMEventTypeDriverNotificationsFinished   = 502 | kIOPMEventTypeIntermediateFlag,
    kIOPMEventTypeCalTimeChange                 = 503 | kIOPMEventTypeIntermediateFlag
};

<span class="enscript-comment">/*****************************************************************************
 *
 * Private Root Domain general interest messages
 *
 * Check IOPM.h when adding new messages to avoid conflict.
 *
 *****************************************************************************/</span>

<span class="enscript-comment">/* kIOPMMessageUserIsActiveChanged
 * User became active or inactive. Message sent after the kIOPMUserIsActiveKey
 * property was updated with a new value.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMMessageUserIsActiveChanged</span> \
                iokit_family_msg(sub_iokit_powermanagement, 0x400)

<span class="enscript-comment">/*
 * Private IOMessage notifications shared between kernel and userspace PM policy
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMMessageLastCallBeforeSleep</span> \
                iokit_family_msg(sub_iokit_powermanagement, 0x410)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMMessageIdleSleepPreventers</span> \
                iokit_family_msg(sub_iokit_powermanagement, 0x420)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMMessageSystemSleepPreventers</span> \
                iokit_family_msg(sub_iokit_powermanagement, 0x430)

<span class="enscript-comment">/* @enum SystemSleepReasons
 * @abstract The potential causes for system sleep as logged in the system event record.
 */</span>
<span class="enscript-type">enum</span> {
    kIOPMSleepReasonClamshell                   = 101,
    kIOPMSleepReasonPowerButton                 = 102,
    kIOPMSleepReasonSoftware                    = 103,
    kIOPMSleepReasonOSSwitchHibernate           = 104,
    kIOPMSleepReasonIdle                        = 105,
    kIOPMSleepReasonLowPower                    = 106,
    kIOPMSleepReasonThermalEmergency            = 107,
    kIOPMSleepReasonMaintenance                 = 108,
    kIOPMSleepReasonSleepServiceExit            = 109,
    kIOPMSleepReasonDarkWakeThermalEmergency    = 110
};

<span class="enscript-comment">/*
 * Possible C-string sleep reasons found under kRootDomainSleepReasonsKey
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMClamshellSleepKey</span>                      <span class="enscript-string">&quot;Clamshell Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMPowerButtonSleepKey</span>                    <span class="enscript-string">&quot;Power Button Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSoftwareSleepKey</span>                       <span class="enscript-string">&quot;Software Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMOSSwitchHibernationKey</span>                 <span class="enscript-string">&quot;OS Switch Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMIdleSleepKey</span>                           <span class="enscript-string">&quot;Idle Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMLowPowerSleepKey</span>                       <span class="enscript-string">&quot;Low Power Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMThermalEmergencySleepKey</span>               <span class="enscript-string">&quot;Thermal Emergency Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepServiceExitKey</span>                    <span class="enscript-string">&quot;Sleep Service Back to Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMDarkWakeThermalEmergencyKey</span>            <span class="enscript-string">&quot;Dark Wake Thermal Emergency&quot;</span>

<span class="enscript-comment">/*! kIOPMPSRestrictedModeKey
 *  An IOPMPowerSource property key
 *  Its property has an integer value.
 *  - value = 1 when the device is in a low power state and not fully functional.
 *  - value = 0, or property missing altogether, when the device is
 *      not in a restricted mode power state.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMPSRestrictedModeKey</span>                    <span class="enscript-string">&quot;RestrictedMode&quot;</span>

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Stray</span> <span class="enscript-variable-name">Bitfields</span>
<span class="enscript-comment">// Private power commands issued to root domain
</span><span class="enscript-comment">// bits 0-7 in IOPM.h
</span>
<span class="enscript-type">enum</span> {
    kIOPMSetValue                   = (1&lt;&lt;16),
    <span class="enscript-comment">// don't sleep on clamshell closure on a portable with AC connected
</span>    kIOPMSetDesktopMode             = (1&lt;&lt;17),
    <span class="enscript-comment">// set state of AC adaptor connected
</span>    kIOPMSetACAdaptorConnected      = (1&lt;&lt;18)
};

<span class="enscript-comment">/*****************************************************************************/</span>
<span class="enscript-comment">/*****************************************************************************/</span>

<span class="enscript-comment">/*
 * PM notification types
 */</span>

<span class="enscript-comment">/*! @constant kIOPMSleepServiceScheduleImmediate
 *
 * Setting type used in calls to IOPMrootDomain::registerPMSettingController
 * Use this type between powerd and IOKit.framework
 *
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepServiceScheduleImmediate</span>     <span class="enscript-string">&quot;SleepServiceImmediate&quot;</span>

<span class="enscript-comment">/*! @constant kIOPMSettingSleepServiceScheduleImmediate
 *
 * Setting type used in calls to IOPMrootDomain::registerPMSettingController
 * Use this type between xnu and AppleRTC
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSettingSleepServiceWakeCalendarKey</span>     <span class="enscript-string">&quot;SleepServiceWakeCalendarKey&quot;</span>

<span class="enscript-comment">/*! @constant kIOPMCalendarWakeTypes
 *
 * These are valid values for IOPM.h:IOPMCalendarStruct-&gt;selector
 */</span>
<span class="enscript-type">enum</span> {
    kPMCalendarTypeMaintenance = 1,
    kPMCalendarTypeSleepService = 2
};


<span class="enscript-comment">/* @constant kIOPMStateConsoleShutdown
 * @abstract Notification of GUI shutdown state available to kexts.
 * @discussion This type can be passed as arguments to registerPMSettingController()
 * to receive callbacks.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStateConsoleShutdown</span>   <span class="enscript-string">&quot;ConsoleShutdown&quot;</span>

<span class="enscript-comment">/* @enum ShutdownValues
 * @abstract Potential values shared with key kIOPMStateConsoleShutdown
 */</span>
<span class="enscript-type">enum</span> {
<span class="enscript-comment">/* @constant kIOPMStateConsoleShutdownNone
 * @abstract System shutdown (or restart) hasn't started; system is ON.
 * @discussion Next state: 2
 */</span>
    kIOPMStateConsoleShutdownNone   = 1,
<span class="enscript-comment">/* @constant kIOPMStateConsoleShutdownPossible
 * @abstract User has been presented with the option to shutdown or restart. Shutdown may be cancelled.
 * @discussion Next state may be: 1, 4
 */</span>
    kIOPMStateConsoleShutdownPossible = 2,
<span class="enscript-comment">/* @constant kIOPMStateConsoleShutdownUnderway
 * @abstract Shutdown or restart is proceeding. It may still be cancelled.
 * @discussion Next state may be: 1, 4. This state is currently unused.
 */</span>
    kIOPMStateConsoleShutdownUnderway = 3,
<span class="enscript-comment">/* @constant kIOPMStateConsoleShutdownCertain
 * @abstract Shutdown is in progress and irrevocable.
 * @discussion State remains 4 until power is removed from CPU.
 */</span>
    kIOPMStateConsoleShutdownCertain = 4,
<span class="enscript-comment">/* @constant kIOPMStateConsoleSULogoutInitiated
   Indicates that LoginWindow has initiated a software update restart.
   The next logout will not immediately lead to a shutdown.
 */</span>
    kIOPMStateConsoleSULogoutInitiated = 5
};

<span class="enscript-comment">/* @constant kIOPMSettingSilentRunningKey
 * @abstract Notification of silent running mode changes to kexts.
 * @discussion This key can be passed as an argument to registerPMSettingController()
 * and also identifies the type of PMSetting notification callback.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSettingSilentRunningKey</span>    <span class="enscript-string">&quot;SilentRunning&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMFeatureSilentRunningKey</span>    kIOPMSettingSilentRunningKey

<span class="enscript-comment">/* @enum SilentRunningFlags
 * @abstract The kIOPMSettingSilentRunningKey notification provides an OSNumber
 * object with a value described by the following flags.
 */</span>
<span class="enscript-type">enum</span> {
    kIOPMSilentRunningModeOn = 0x00000001
};

<span class="enscript-comment">/*****************************************************************************/</span>
<span class="enscript-comment">/*****************************************************************************/</span>

<span class="enscript-comment">/* PM Statistics - event indices
 * These are arguments to IOPMrootDomain::pmStatsRecordEvent().
 */</span>
<span class="enscript-type">enum</span> {
    kIOPMStatsHibernateImageWrite         = 1,
    kIOPMStatsHibernateImageRead,
    kIOPMStatsDriversNotify,
    kIOPMStatsApplicationNotify,
    kIOPMStatsLateDriverAcknowledge,
    kIOPMStatsLateAppAcknowledge,

    <span class="enscript-comment">// To designate if you're specifying the start or stop end of
</span>    <span class="enscript-comment">// each of the above events, do a bitwise OR of the appropriate
</span>    <span class="enscript-comment">// Start/Stop flag and pass the result to IOPMrootDomain to record
</span>    <span class="enscript-comment">// the event.
</span>    kIOPMStatsEventStartFlag              = (1 &lt;&lt; 24),
    kIOPMStatsEventStopFlag               = (1 &lt;&lt; 25)
};

<span class="enscript-comment">// Keys for IOPMrootDomain registry properties
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepStatisticsKey</span>                 <span class="enscript-string">&quot;SleepStatistics&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepStatisticsAppsKey</span>             <span class="enscript-string">&quot;AppStatistics&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMIdleSleepPreventersKey</span>             <span class="enscript-string">&quot;IdleSleepPreventers&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSystemSleepPreventersKey</span>           <span class="enscript-string">&quot;SystemSleepPreventers&quot;</span>

<span class="enscript-comment">// Application response statistics
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsNameKey</span>                       <span class="enscript-string">&quot;Name&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsPIDKey</span>                        <span class="enscript-string">&quot;Pid&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsTimeMSKey</span>                     <span class="enscript-string">&quot;TimeMS&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsApplicationResponseTypeKey</span>    <span class="enscript-string">&quot;ResponseType&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsMessageTypeKey</span>                <span class="enscript-string">&quot;MessageType&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsPowerCapabilityKey</span>            <span class="enscript-string">&quot;PowerCaps&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsSystemTransitionKey</span>           <span class="enscript-string">&quot;TransitionType&quot;</span>

<span class="enscript-comment">// PM Statistics: potential values for the key kIOPMStatsApplicationResponseTypeKey
</span><span class="enscript-comment">// entry in the application results array.
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsResponseTimedOut</span>      <span class="enscript-string">&quot;ResponseTimedOut&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsResponseCancel</span>        <span class="enscript-string">&quot;ResponseCancel&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsResponseSlow</span>          <span class="enscript-string">&quot;ResponseSlow&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsResponsePrompt</span>        <span class="enscript-string">&quot;ResponsePrompt&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMStatsDriverPSChangeSlow</span>    <span class="enscript-string">&quot;DriverPSChangeSlow&quot;</span>

<span class="enscript-type">struct</span> PMStatsBounds{
    uint64_t start;
    uint64_t stop;
};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {

    <span class="enscript-type">struct</span> PMStatsBounds    hibWrite;
    <span class="enscript-type">struct</span> PMStatsBounds    hibRead;
<span class="enscript-comment">//    bounds    driverNotifySleep;
</span><span class="enscript-comment">//    bounds    driverNotifyWake;
</span><span class="enscript-comment">//    bounds    appNotifySleep;
</span><span class="enscript-comment">//    bounds    appNotifyWake;
</span><span class="enscript-comment">//    OSDictionary    *tardyApps;
</span><span class="enscript-comment">//    OSDictionary    *tardyDrivers;
</span>} PMStatsStruct;

<span class="enscript-comment">/*****************************************************************************/</span>

<span class="enscript-comment">/* PM RootDomain tracePoints
 *
 * In the sleep/wake process, we expect the sleep trace points to proceed
 * in increasing order. Once sleep begins with code kIOPMTracePointSleepStarted,
 * we expect sleep to continue in a monotonically increasing order of tracepoints
 * to kIOPMTracePointSystemLoginwindowPhase. After trace point SystemLoginWindowPhase,
 * the system will return to kIOPMTracePointSystemUp.
 *
 * If the trace point decreases (instead of increasing) before reaching kIOPMTracePointSystemUp,
 * that indicates that the sleep process was cancelled. The cancel reason shall be indicated
 * in the cancel tracepoint. (TBD)
 */</span>

<span class="enscript-type">enum</span> {
<span class="enscript-comment">/* When kTracePointSystemUp is the latest tracePoint,
 * the system is awake. It is not asleep, sleeping, or waking.
 *
 * Phase begins: At boot, at completion of wake from sleep,
 *      immediately following kIOPMTracePointSystemLoginwindowPhase.
 * Phase ends: When a sleep attempt is initiated.
 */</span>
    kIOPMTracePointSystemUp                     = 0,

<span class="enscript-comment">/* When kIOPMTracePointSleepStarted is the latest tracePoint,
 * sleep has been initiated.
 *
 * Phase begins: At initiation of system sleep (idle or forced).
 * Phase ends: PM starts to notify applications of system sleep.
 */</span>
    kIOPMTracePointSleepStarted                 = 0x10,

<span class="enscript-comment">/* When kIOPMTracePointSleepApplications is the latest tracePoint,
 * a system sleep has been initiated and PM waits for responses
 * from notified applications.
 *
 * Phase begins: Begin to asynchronously fire kIOMessageSystemWillSleep
 *      notifications, and also kIOMessageCanSystemSleep for the idle sleep case.
 * Phase ends: When PM has received all application responses.
 */</span>
    kIOPMTracePointSleepApplications            = 0x11,

<span class="enscript-comment">/* When kIOPMTracePointSleepPriorityClients is the latest tracePoint,
 * PM is notifying priority clients and in-kernel system capability
 * clients, and waiting for any asynchronous completions.
 *
 * Phase begins: Synchronous delivery of kIOMessageSystemWillSleep notifications.
 * Phase ends: All notified clients have acknowledged.
 */</span>
    kIOPMTracePointSleepPriorityClients         = 0x12,

<span class="enscript-comment">/* When kIOPMTracePointSleepWillChangeInterests is the latest tracePoint,
 * PM is calling powerStateWillChangeTo() on interested drivers of root domain.
 *
 * Phase begins: Dispatch a callout thread to call interested drivers.
 * Phase ends: Callout thread work done, and acknowledgePowerChange() called
 *      by drivers that indicated asynchronous completion.
 */</span>
    kIOPMTracePointSleepWillChangeInterests     = 0x13,

<span class="enscript-comment">/* When kIOPMTracePointSleepPowerPlaneDrivers is the latest tracePoint,
 * PM is directing power plane drivers to power off in leaf-to-root order.
 *
 * Phase begins: Root domain informs its power children that it will drop to
 *      sleep state. This has a cascade effect and triggers all drivers in
 *      the power plane to transition to a lower power state if necessary.
 * Phase ends: All power transitions in response to the root domain power
 *      change have completed.
 */</span>
    kIOPMTracePointSleepPowerPlaneDrivers       = 0x14,

<span class="enscript-comment">/* When kIOPMTracePointSleepDidChangeInterests is the latest tracePoint,
 * PM is calling powerStateDidChangeTo() on interested drivers of root domain.
 *
 * Phase begins: Dispatch a callout thread to call interested drivers.
 * Phase ends: Callout thread work done, and acknowledgePowerChange() called
 *      by drivers that indicated asynchronous completion.
 */</span>
    kIOPMTracePointSleepDidChangeInterests      = 0x15,

<span class="enscript-comment">/* When kIOPMTracePointSleepCapabilityClients is the latest tracePoint,
 * PM is notifying system capability clients about system sleep.
 *
 * Phase begins: Send kIOMessageSystemCapabilityChange notifications to inform
 *      capability clients that system has lost all capabilities.
 * Phase ends: Finished sending notifications.
 */</span>
    kIOPMTracePointSleepCapabilityClients       = 0x16,

<span class="enscript-comment">/* When kIOPMTracePointSleepPlatformActions is the latest tracePoint,
 * PM is calling drivers that have registered a platform sleep action.
 */</span>
    kIOPMTracePointSleepPlatformActions         = 0x17,

<span class="enscript-comment">/* When kIOPMTracePointSleepCPUs is the latest tracePoint,
 * PM is shutting down all non-boot processors.
 *
 * Phase begins: Shutdown all non-boot processors.
 * Phase ends: Reduced to only the boot processor running.
 */</span>
    kIOPMTracePointSleepCPUs                    = 0x18,

<span class="enscript-comment">/* When kIOPMTracePointSleepPlatformDriver is the latest tracePoint,
 * PM is executing platform dependent code to prepare for system sleep.
 */</span>
    kIOPMTracePointSleepPlatformDriver          = 0x19,

<span class="enscript-comment">/* When kIOPMTracePointHibernate is the latest tracePoint,
 * PM is writing the hibernate image to disk.
 */</span>
    kIOPMTracePointHibernate                    = 0x1a,

<span class="enscript-comment">/* When kIOPMTracePointSystemSleep is the latest tracePoint,
 * PM has recorded the final trace point before the hardware platform
 * enters sleep state, or low level wakeup is underway - such as restoring
 * the hibernate image from disk.
 *
 * Note: If a system is asleep and then loses power, and it does not have a
 * hibernate image to restore from (e.g. hibernatemode = 0), then OS X will
 * interpret this power loss as a failure in kIOPMTracePointSystemSleep.
 *
 * Phase begins: Before the OS directs the hardware to enter sleep state.
 * Phase ends: Control returns to the OS on wake, but before recording the first
 *      wake trace point.
 */</span>
    kIOPMTracePointSystemSleep                  = 0x1f,

<span class="enscript-comment">/* When kIOPMTracePointWakePlatformDriver is the latest tracePoint,
 * PM is executing platform dependent code to prepare for system wake.
 */</span>
    kIOPMTracePointWakePlatformDriver           = 0x21,

<span class="enscript-comment">/* When kIOPMTracePointWakePlatformActions is the latest tracePoint,
 * PM is calling drivers that have registered a platform wake action.
 */</span>
    kIOPMTracePointWakePlatformActions          = 0x22,

<span class="enscript-comment">/* When kIOPMTracePointWakeCPUs is the latest tracePoint,
 * PM is bringing all non-boot processors online.
 */</span>
    kIOPMTracePointWakeCPUs                     = 0x23,

<span class="enscript-comment">/* When kIOPMTracePointWakeWillPowerOnClients is the latest tracePoint,
 * PM is sending kIOMessageSystemWillPowerOn to both kernel clients and
 * applications. PM also notifies system capability clients about the
 * proposed capability change.
 *
 * Phase begins: Send kIOMessageSystemWillPowerOn and
 *      kIOMessageSystemCapabilityChange notifications.
 * Phase ends: Finished sending notifications.
 */</span>
    kIOPMTracePointWakeWillPowerOnClients       = 0x24,

<span class="enscript-comment">/* When kIOPMTracePointWakeWillChangeInterests is the latest tracePoint,
 * PM is calling powerStateWillChangeTo() on interested drivers of root domain.
 *
 * Phase begins: Dispatch a callout thread to call interested drivers.
 * Phase ends: Callout thread work done, and acknowledgePowerChange() called
 *      by drivers that indicated asynchronous completion.
 */</span>
    kIOPMTracePointWakeWillChangeInterests      = 0x25,

<span class="enscript-comment">/* When kIOPMTracePointWakeDidChangeInterests is the latest tracePoint,
 * PM is calling powerStateDidChangeTo() on interested drivers of root domain.
 *
 * Phase begins: Dispatch a callout thread to call interested drivers.
 * Phase ends: Callout thread work done, and acknowledgePowerChange() called
 *      by drivers that indicated asynchronous completion.
 */</span>
    kIOPMTracePointWakeDidChangeInterests       = 0x26,

<span class="enscript-comment">/* When kIOPMTracePointWakePowerPlaneDrivers is the latest tracePoint,
 * PM is directing power plane drivers to power up in root-to-leaf order.
 *
 * Phase begins: Root domain informs its power children that it transitioned
 *      to ON state. This has a cascade effect and triggers all drivers in
 *      the power plane to re-evaluate and potentially change power state.
 * Phase ends: All power transitions in response to the root domain power
 *      change have completed.
 */</span>
    kIOPMTracePointWakePowerPlaneDrivers        = 0x27,

<span class="enscript-comment">/* When kIOPMTracePointWakeCapabilityClients is the latest tracePoint,
 * PM is notifying system capability clients about system wake, and waiting
 * for any asynchronous completions.
 *
 * Phase begins: Inform capability clients that system has gained capabilities.
 * Phase ends: All notified clients have acknowledged.
 */</span>
    kIOPMTracePointWakeCapabilityClients        = 0x28,

<span class="enscript-comment">/* When kIOPMTracePointWakeApplications is the latest tracePoint,
 * System CPU is powered, PM has powered on each driver.
 *
 * Phase begins: Send asynchronous kIOMessageSystemHasPoweredOn notifications.
 * Phase ends: Finished sending asynchronous notifications.
 */</span>
    kIOPMTracePointWakeApplications             = 0x29,

<span class="enscript-comment">/* kIOPMTracePointSystemLoginwindowPhase
 * This phase represents a several minute window after the system has powered on.
 * Higher levels of system diagnostics are in a heightened state of alert in this phase,
 * in case any user errors occurred that we could not detect in software.
 *
 * Phase begins: After IOPMrootDomain sends kIOMessageSystemHasPoweredOn message.
 * Phase ends: When loginwindow calls IOPMSleepWakeSetUUID(NULL) the system shall
 *      be considered awake and usable. The next phase shall be kIOPMTracePointSystemUp.
 */</span>
    kIOPMTracePointSystemLoginwindowPhase       = 0x30,

<span class="enscript-comment">/* When kIOPMTracePointDarkWakeEntry is the latest tracePoint,
 * PM has started a transition from full wake to dark wake.
 *
 * Phase begins: Start transition to dark wake.
 * Phase ends: System in dark wake. Before recording kIOPMTracePointSystemUp.
 */</span>
    kIOPMTracePointDarkWakeEntry                = 0x31,

<span class="enscript-comment">/* When kIOPMTracePointDarkWakeExit is the latest tracePoint,
 * PM has started a transition from dark wake to full wake.
 *
 * Phase begins: Start transition to full wake.
 * Phase ends: System in full wake. Before recording kIOPMTracePointSystemUp.
 */</span>
    kIOPMTracePointDarkWakeExit                 = 0x32
};

<span class="enscript-comment">/*****************************************************************************/</span>

<span class="enscript-comment">/*
Ê* kIOPMLoginWindowSecurityDebugKey - identifies PM debug data specific to LoginWindow
 *  for use with IOPMrootDomain.
Ê*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMLoginWindowSecurityDebugKey</span>        <span class="enscript-string">&quot;LoginWindowSecurity&quot;</span>

<span class="enscript-comment">// For PM internal use only - key to locate sleep failure results within SCDynamicStore.
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMDynamicStoreSleepFailureKey</span>        <span class="enscript-string">&quot;SleepFailure&quot;</span>

<span class="enscript-comment">/*****************************************************************************/</span>

<span class="enscript-comment">// For IOPMLibPrivate.h
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepWakeFailureKey</span>            <span class="enscript-string">&quot;PMFailurePhase&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepWakeFailureCodeKey</span>        <span class="enscript-string">&quot;PMStatusCode&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepWakeFailureLoginKey</span>       <span class="enscript-string">&quot;LWFailurePhase&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepWakeFailureUUIDKey</span>        <span class="enscript-string">&quot;UUID&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepWakeFailureDateKey</span>        <span class="enscript-string">&quot;Date&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepWakeWdogRebootKey</span>         <span class="enscript-string">&quot;SWWdogTriggeredRestart&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSleepWakeWdogLogsValidKey</span>      <span class="enscript-string">&quot;SWWdogLogsValid&quot;</span>

<span class="enscript-comment">/*****************************************************************************
 *
 * Root Domain private property keys
 *
 *****************************************************************************/</span>

<span class="enscript-comment">/* kIOPMFeatureAutoPowerOffKey
 * Feature published if Auto Power Off is supported
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMFeatureAutoPowerOffKey</span>         <span class="enscript-string">&quot;AutoPowerOff&quot;</span>

<span class="enscript-comment">/* kIOPMAutoPowerOffEnabledKey
 * Indicates if Auto Power Off is enabled.
 * It has a boolean value.
 *  true        == Auto Power Off is enabled
 *  false       == Auto Power Off is disabled
 *  not present == Auto Power Off is not supported on this hardware
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMAutoPowerOffEnabledKey</span>         <span class="enscript-string">&quot;AutoPowerOff Enabled&quot;</span>

<span class="enscript-comment">/* kIOPMAutoPowerOffDelayKey
 * Key refers to a CFNumberRef that represents the delay in seconds before
 * entering the Auto Power Off state.  The property is not present if Auto
 * Power Off is unsupported.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMAutoPowerOffDelayKey</span>           <span class="enscript-string">&quot;AutoPowerOff Delay&quot;</span>

<span class="enscript-comment">/* kIOPMAutoPowerOffTimerKey
 * Key refers to a CFNumberRef that indicates the time in seconds until the
 * expiration of the Auto Power Off delay period. This value should be used
 * to program a wake alarm before system sleep.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMAutoPowerOffTimerKey</span>           <span class="enscript-string">&quot;AutoPowerOff Timer&quot;</span>

<span class="enscript-comment">/* kIOPMUserWakeAlarmScheduledKey
 * Key refers to a boolean value that indicates if an user alarm was scheduled
 * or pending.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMUserWakeAlarmScheduledKey</span>      <span class="enscript-string">&quot;UserWakeAlarmScheduled&quot;</span>

<span class="enscript-comment">/* kIOPMDeepIdleSupportedKey
 * Presence of this key indicates Deep Idle is supported on this platform.
 * Key will always refer to a value of kOSBooleanTrue.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMDeepIdleSupportedKey</span>           <span class="enscript-string">&quot;IOPMDeepIdleSupported&quot;</span>

<span class="enscript-comment">/* kIOPMUserTriggeredFullWakeKey
 * Key refers to a boolean value that indicates if the first full wake since
 * last system sleep was triggered by the local user. This property is set
 * before the initial full wake transition, and removed after powering down
 * drivers for system sleep.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMUserTriggeredFullWakeKey</span>       <span class="enscript-string">&quot;IOPMUserTriggeredFullWake&quot;</span>

<span class="enscript-comment">/* kIOPMUserIsActiveKey
 * Key refers to a boolean value that indicates if the user is active.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMUserIsActiveKey</span>                <span class="enscript-string">&quot;IOPMUserIsActive&quot;</span>

<span class="enscript-comment">/* kIOPMDriverWakeEventsKey
 * Key refers to a property that should only be examined by powerd.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMDriverWakeEventsKey</span>            <span class="enscript-string">&quot;IOPMDriverWakeEvents&quot;</span>

<span class="enscript-comment">/*****************************************************************************
 *
 * IOPMDriverWakeEvents dictionary keys
 *
 *****************************************************************************/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMWakeEventTimeKey</span>               <span class="enscript-string">&quot;Time&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMWakeEventFlagsKey</span>              <span class="enscript-string">&quot;Flags&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMWakeEventReasonKey</span>             <span class="enscript-string">&quot;Reason&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMWakeEventDetailsKey</span>            <span class="enscript-string">&quot;Details&quot;</span>

<span class="enscript-comment">/*****************************************************************************
 *
 * Wake event flags reported to IOPMrootDomain::claimSystemWakeEvent()
 *
 *****************************************************************************/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMWakeEventSource</span>                0x00000001

<span class="enscript-comment">/*****************************************************************************
 *
 * System Sleep Policy
 *
 *****************************************************************************/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSystemSleepPolicySignature</span>     0x54504c53
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSystemSleepPolicyVersion</span>       2

<span class="enscript-comment">/*!
 * @defined kIOPMSystemSleepTypeKey
 * @abstract Indicates the type of system sleep.
 * @discussion An OSNumber property of root domain that describes the type
 * of system sleep. This property is set after notifying priority sleep/wake
 * clients, but before informing interested drivers and shutting down power
 * plane drivers. On a hibernate abort or failure, this property will not be
 * updated and will indicate the failed sleep type.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSystemSleepTypeKey</span>             <span class="enscript-string">&quot;IOPMSystemSleepType&quot;</span>

<span class="enscript-type">struct</span> IOPMSystemSleepPolicyVariables
{
    uint32_t    signature;                  <span class="enscript-comment">// kIOPMSystemSleepPolicySignature
</span>    uint32_t    version;                    <span class="enscript-comment">// kIOPMSystemSleepPolicyVersion
</span>
    uint64_t    currentCapability;          <span class="enscript-comment">// current system capability bits
</span>    uint64_t    highestCapability;          <span class="enscript-comment">// highest system capability bits
</span>
    uint64_t    sleepFactors;               <span class="enscript-comment">// sleep factor bits
</span>    uint32_t    sleepReason;                <span class="enscript-comment">// kIOPMSleepReason*
</span>    uint32_t    sleepPhase;                 <span class="enscript-comment">// identify the sleep phase
</span>    uint32_t    hibernateMode;              <span class="enscript-comment">// current hibernate mode
</span>
    uint32_t    standbyDelay;               <span class="enscript-comment">// standby delay in seconds
</span>    uint32_t    poweroffDelay;              <span class="enscript-comment">// auto-poweroff delay in seconds
</span>    uint32_t    scheduledAlarms;            <span class="enscript-comment">// bitmask of scheduled alarm types
</span>    uint32_t    poweroffTimer;              <span class="enscript-comment">// auto-poweroff timer in seconds
</span>
    uint32_t    reserved[49];               <span class="enscript-comment">// pad sizeof 256 bytes
</span>};

<span class="enscript-type">enum</span> {
    kIOPMAlarmBitDebugWake                  = 0x01,
    kIOPMAlarmBitCalendarWake               = 0x02,
    kIOPMAlarmBitMaintenanceWake            = 0x04,
    kIOPMAlarmBitSleepServiceWake           = 0x08
};

<span class="enscript-type">enum</span> {
    kIOPMSleepPhase0 = 0,
    kIOPMSleepPhase1,
    kIOPMSleepPhase2
};

<span class="enscript-comment">// Sleep Factor Mask / Bits
</span><span class="enscript-type">enum</span> {
    kIOPMSleepFactorSleepTimerWake          = 0x00000001ULL,
    kIOPMSleepFactorLidOpen                 = 0x00000002ULL,
    kIOPMSleepFactorACPower                 = 0x00000004ULL,
    kIOPMSleepFactorBatteryLow              = 0x00000008ULL,
    kIOPMSleepFactorStandbyNoDelay          = 0x00000010ULL,
    kIOPMSleepFactorStandbyForced           = 0x00000020ULL,
    kIOPMSleepFactorStandbyDisabled         = 0x00000040ULL,
    kIOPMSleepFactorUSBExternalDevice       = 0x00000080ULL,
    kIOPMSleepFactorBluetoothHIDDevice      = 0x00000100ULL,
    kIOPMSleepFactorExternalMediaMounted    = 0x00000200ULL,
    kIOPMSleepFactorThunderboltDevice       = 0x00000400ULL,
    kIOPMSleepFactorRTCAlarmScheduled       = 0x00000800ULL,
    kIOPMSleepFactorMagicPacketWakeEnabled  = 0x00001000ULL,
    kIOPMSleepFactorHibernateForced         = 0x00010000ULL,
    kIOPMSleepFactorAutoPowerOffDisabled    = 0x00020000ULL,
    kIOPMSleepFactorAutoPowerOffForced      = 0x00040000ULL,
    kIOPMSleepFactorExternalDisplay         = 0x00080000ULL,
    kIOPMSleepFactorNetworkKeepAliveActive  = 0x00100000ULL,
    kIOPMSleepFactorLocalUserActivity       = 0x00200000ULL,
    kIOPMSleepFactorHibernateFailed         = 0x00400000ULL,
    kIOPMSleepFactorThermalWarning          = 0x00800000ULL,
    kIOPMSleepFactorDisplayCaptured         = 0x01000000ULL
};

<span class="enscript-comment">// System Sleep Types
</span><span class="enscript-type">enum</span> {
    kIOPMSleepTypeInvalid                   = 0,
    kIOPMSleepTypeAbortedSleep              = 1,
    kIOPMSleepTypeNormalSleep               = 2,
    kIOPMSleepTypeSafeSleep                 = 3,
    kIOPMSleepTypeHibernate                 = 4,
    kIOPMSleepTypeStandby                   = 5,
    kIOPMSleepTypePowerOff                  = 6,
    kIOPMSleepTypeDeepIdle                  = 7,
    kIOPMSleepTypeLast                      = 8
};

<span class="enscript-comment">// System Sleep Flags
</span><span class="enscript-type">enum</span> {
    kIOPMSleepFlagDisableHibernateAbort     = 0x00000001,
    kIOPMSleepFlagDisableUSBWakeEvents      = 0x00000002,
    kIOPMSleepFlagDisableBatlowAssertion    = 0x00000004,
    kIOPMSleepFlagDisableS4WakeSources      = 0x00000008
};

<span class="enscript-comment">// System Wake Events
</span><span class="enscript-type">enum</span> {
    kIOPMWakeEventLidOpen                   = 0x00000001,
    kIOPMWakeEventLidClose                  = 0x00000002,
    kIOPMWakeEventACAttach                  = 0x00000004,
    kIOPMWakeEventACDetach                  = 0x00000008,
    kIOPMWakeEventCDInsert                  = 0x00000010,
    kIOPMWakeEventCDEject                   = 0x00000020,
    kIOPMWakeEventHPDAttach                 = 0x00000040,
    kIOPMWakeEventHPDDetach                 = 0x00000080,
    kIOPMWakeEventPowerButton               = 0x00000100,
    kIOPMWakeEventG3PowerOn                 = 0x00000200,
    kIOPMWakeEventUserPME                   = 0x00000400,
    kIOPMWakeEventSleepTimer                = 0x00000800,
    kIOPMWakeEventBatteryLow                = 0x00001000,
    kIOPMWakeEventDarkPME                   = 0x00002000
};

<span class="enscript-comment">/*!
 * @defined kIOPMSystemSleepParametersKey
 * @abstract Sleep parameters describing the upcoming sleep
 * @discussion Root domain updates this OSData property before system sleep
 * to pass sleep parameters to the platform driver.  Some of the parameters
 * are based on the chosen entry in the system sleep policy table.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSystemSleepParametersKey</span>       <span class="enscript-string">&quot;IOPMSystemSleepParameters&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSystemSleepParametersVersion</span>   2

<span class="enscript-type">struct</span> IOPMSystemSleepParameters
{
    uint16_t    version;
    uint16_t    reserved1;
    uint32_t    sleepType;
    uint32_t    sleepFlags;
    uint32_t    ecWakeEvents;
    uint32_t    ecWakeTimer;
    uint32_t    ecPoweroffTimer;
    uint32_t    reserved2[10];
} __attribute__((packed));


<span class="enscript-comment">/*
 * Sleep Wake debug buffer header
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
   uint32_t signature;
   uint32_t alloc_size;
   uint32_t          crc;             <span class="enscript-comment">/* CRC for spindump &amp; following data.*/</span>
   uint32_t          spindump_offset; <span class="enscript-comment">/* Offset at which spindump offset is stored */</span>
   uint32_t          spindump_size;
   uint8_t           is_osx_watchdog;

   <span class="enscript-comment">/* All members from UUID onwards are saved into log file */</span>
   <span class="enscript-type">char</span>             UUID[44];
   <span class="enscript-type">char</span>             cps[9];          <span class="enscript-comment">/* Current power state */</span>
   <span class="enscript-type">char</span>             PMStatusCode[32];
   <span class="enscript-type">char</span>             reason[32];
} swd_hdr;

<span class="enscript-comment">/*
 * Structure between stackshot samples, expected by spindump
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint32_t magic;      <span class="enscript-comment">// 0xbad51ee4
</span>    uint32_t size;       <span class="enscript-comment">// Size of the stackshot buffer following this struct
</span>} swd_stackshot_hdr;


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_HDR_SIGNATURE</span>       0xdeb8da2a
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_STACKSHOTHDR_MAGIC</span>  0xbad51ee4  // expected by spindump

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_BUF_SIZE</span>            (40*PAGE_SIZE)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_INITIAL_STACK_SIZE</span>  ((SWD_BUF_SIZE/2)-sizeof(swd_hdr))

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_SPINDUMP_SIZE</span>          (256*1024)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_INITIAL_SPINDUMP_SIZE</span>  ((SWD_SPINDUMP_SIZE/2)-sizeof(swd_hdr))

<span class="enscript-comment">/* Bits in swd_flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_WDOG_ENABLED</span>        0x01
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_BOOT_BY_SW_WDOG</span>     0x02
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_BOOT_BY_OSX_WDOG</span>    0x04
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_VALID_LOGS</span>          0x08
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_LOGS_IN_FILE</span>        0x10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SWD_LOGS_IN_MEM</span>         0x20

<span class="enscript-comment">/* Filenames associated with the stackshots/logs generated by the SWD */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kSleepWakeStackBinFilename</span>          <span class="enscript-string">&quot;/var/log/SleepWakeStacks.bin&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kSleepWakeStackFilename</span>             <span class="enscript-string">&quot;/var/log/SleepWakeStacks.dump&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kSleepWakeLogFilename</span>               <span class="enscript-string">&quot;/var/log/SleepWakeLog.dump&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kAppleOSXWatchdogStackFilename</span>      <span class="enscript-string">&quot;/var/log/AppleOSXWatchdogStacks.dump&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kAppleOSXWatchdogLogFilename</span>        <span class="enscript-string">&quot;/var/log/AppleOSXWatchdogLog.dump&quot;</span>

inline <span class="enscript-type">char</span> <span class="enscript-type">const</span>* <span class="enscript-function-name">getDumpStackFilename</span>(swd_hdr *hdr)
{
    <span class="enscript-keyword">if</span> (hdr &amp;&amp; hdr-&gt;is_osx_watchdog)
        <span class="enscript-keyword">return</span> kAppleOSXWatchdogStackFilename;
    <span class="enscript-keyword">return</span> kSleepWakeStackFilename;
}

inline <span class="enscript-type">char</span> <span class="enscript-type">const</span>* <span class="enscript-function-name">getDumpLogFilename</span>(swd_hdr *hdr)
{
    <span class="enscript-keyword">if</span> (hdr &amp;&amp; hdr-&gt;is_osx_watchdog)
        <span class="enscript-keyword">return</span> kAppleOSXWatchdogLogFilename;
    <span class="enscript-keyword">return</span> kSleepWakeLogFilename;
}

<span class="enscript-comment">/* RootDomain IOReporting channels */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kSleepCntChID</span> IOREPORT_MAKEID(<span class="enscript-string">'S'</span>,<span class="enscript-string">'l'</span>,<span class="enscript-string">'e'</span>,<span class="enscript-string">'e'</span>,<span class="enscript-string">'p'</span>,<span class="enscript-string">'C'</span>,<span class="enscript-string">'n'</span>,<span class="enscript-string">'t'</span>)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kDarkWkCntChID</span> IOREPORT_MAKEID(<span class="enscript-string">'G'</span>,<span class="enscript-string">'U'</span>,<span class="enscript-string">'I'</span>,<span class="enscript-string">'W'</span>,<span class="enscript-string">'k'</span>,<span class="enscript-string">'C'</span>,<span class="enscript-string">'n'</span>,<span class="enscript-string">'t'</span>)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kUserWkCntChID</span> IOREPORT_MAKEID(<span class="enscript-string">'D'</span>,<span class="enscript-string">'r'</span>,<span class="enscript-string">'k'</span>,<span class="enscript-string">'W'</span>,<span class="enscript-string">'k'</span>,<span class="enscript-string">'C'</span>,<span class="enscript-string">'n'</span>,<span class="enscript-string">'t'</span>)

<span class="enscript-comment">/*
 * kAssertDelayChID - Histogram of time elapsed before assertion after wake.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kAssertDelayBcktCnt</span>     11
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kAssertDelayBcktSize</span>    3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kAssertDelayChID</span> IOREPORT_MAKEID(<span class="enscript-string">'r'</span>,<span class="enscript-string">'d'</span>,<span class="enscript-string">'A'</span>,<span class="enscript-string">'s'</span>,<span class="enscript-string">'r'</span>,<span class="enscript-string">'t'</span>,<span class="enscript-string">'D'</span>,<span class="enscript-string">'l'</span>)

<span class="enscript-comment">/*
 * kSleepDelaysChID - Histogram of time taken to put system to sleep
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kSleepDelaysBcktCnt</span>     13
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kSleepDelaysBcktSize</span>    10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kSleepDelaysChID</span> IOREPORT_MAKEID(<span class="enscript-string">'r'</span>,<span class="enscript-string">'d'</span>,<span class="enscript-string">'S'</span>,<span class="enscript-string">'l'</span>,<span class="enscript-string">'p'</span>,<span class="enscript-string">'D'</span>,<span class="enscript-string">'l'</span>,<span class="enscript-string">'y'</span>)

<span class="enscript-comment">/* Sleep Options/settings */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kSleepOptionDisplayCapturedModeKey</span>         <span class="enscript-string">&quot;DisplayCapturedMode&quot;</span>


#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>) &amp;&amp; <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__cplusplus</span>)

<span class="enscript-comment">/*!
 * @defined kIOPMInstallSystemSleepPolicyHandlerKey
 * @abstract Name of the platform function to install a sleep policy handler.
 * @discussion Pass to IOPMrootDomain::callPlatformFunction(), with a pointer
 * to the C-function handler at param1, and an optional target at param2, to
 * register a sleep policy handler. Only a single sleep policy handler can
 * be installed.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMInstallSystemSleepPolicyHandlerKey</span> \
        <span class="enscript-string">&quot;IOPMInstallSystemSleepPolicyHandler&quot;</span>

<span class="enscript-type">typedef</span> <span class="enscript-function-name">IOReturn</span> (*IOPMSystemSleepPolicyHandler)(
        <span class="enscript-type">void</span> * target,
        <span class="enscript-type">const</span> IOPMSystemSleepPolicyVariables * vars,
        IOPMSystemSleepParameters * params );

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-comment">/*****************************************************************************
 *
 * Performance Warning
 *
 *****************************************************************************/</span>

<span class="enscript-comment">/* Performance Warning Key
 * Key for performance warning event published using IOPMrootDomain::
 * systemPowerEventOccurred()
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMPerformanceWarningKey</span>          <span class="enscript-string">&quot;Performance_Warning&quot;</span>

<span class="enscript-comment">/* Performance warning values */</span>
<span class="enscript-type">enum</span> {
  kIOPMPerformanceNormal    = 0,
  kIOPMPerformanceWarning   = 100
};

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* ! _IOKIT_IOPMPRIVATE_H */</span>
</pre>
<hr />
</body></html>